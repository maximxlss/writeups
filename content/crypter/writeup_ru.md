---
title: Crypter (Russian CTF Cup 2024 Final; A/D, crypto) RU VERSION
draft: false
tags: []
date: 2024-12-21
---
–í–µ—Å–µ–ª—ã–π —Å–µ—Ä–≤–∏—Å, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —è –ø—Ä–æ—Å–∏–¥–µ–ª –ø–æ—á—Ç–∏ –≤–µ—Å—å –ö—É–±–æ–∫, –æ–∫–æ–ª–æ —Å–µ–º–∏ —á–∞—Å–æ–≤.

### –ò–Ω—Ç—Ä–æ
–í –æ–±—â–µ–º, —Å —ç—Ç–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ —è –∏ –Ω–∞—á–∞–ª, —É–≤–∏–¥–µ–≤ –Ω–∞–º–µ–∫ –Ω–∞ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—é; –Ω–µ —Ç–æ —á—Ç–æ–±—ã —è –±—ã–ª –æ—Å–æ–±–µ–Ω–Ω–æ —Ä–∞–¥ —É–≤–∏–¥–µ—Ç—å —Ç–∞–º C++, –Ω–æ —Ä–∞–¥–∏ –∫—Ä–∏–ø—Ç—ã —è –Ω–∞ –º–Ω–æ–≥–æ–µ –≥–æ—Ç–æ–≤.

–ù–∞–¥–æ –ø—Ä–∏–∑–Ω–∞—Ç—å—Å—è, –ø—Ä–æ –∫—Ä–∏–ø—Ç–æ—Å–∏—Å—Ç–µ–º—É –ü—ç–π–µ —è –ø–æ—á—Ç–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞–ª –¥–æ —ç—Ç–æ–≥–æ —Ç–∞—Å–∫–∞, —Ö–æ—Ç—è [–Ω–µ–∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø–æ–º–∏–Ω–∞—é—â–∏–π—Å—è –æ–ø—ã—Ç](https://github.com/C4T-BuT-S4D/ctfcup-2023-quals/tree/master/tasks/crp/lateralus) —Å –Ω–µ–π –±—ã–ª, –ø–æ—ç—Ç–æ–º—É $(n + 1)^m\pmod{n^2}$ —è –±—ã—Å—Ç—Ä–æ –∑–∞–º–µ—Ç–∏–ª.

–°—É—Ä—Å—ã —Å–µ—Ä–≤–∏—Å–∞ —è —Å–æ—Ö—Ä–∞–Ω–∏–ª [—Ç—É—Ç](https://github.com/maximxlss/writeups/tree/v4/content/crypter/source).

### –°–µ—Ä–≤–∏—Å
–°–µ—Ä–≤–∏—Å –ø—Ä–æ—Å—Ç–æ–π –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É, –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ C++ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º gRPC, gmp –∏ Postgres. –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏—á–∏:
- –°–∏—Å—Ç–µ–º–∞ —é–∑–µ—Ä–æ–≤. –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–∞–∂–¥—ã–π —é–∑–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–∫–µ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π, —Å–ª—É—á–∞–π–Ω—ã–π $n=pq$ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á, –∞ —Ç–∞–∫–∂–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –≤ –≤–∏–¥–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –≠–π–ª–µ—Ä–∞ $\phi(n)=(p - 1)(q - 1)$ (—Ç—É—Ç –±—ã–ª–∞ –ø–µ—Ä–≤–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å –ø–æ–ø—Ä–æ—â–µ). –ü—É–±–ª–∏—á–Ω—ã–µ –∫–ª—é—á–∏ –¥—Ä—É–≥–∏—Ö —é–∑–µ—Ä–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.
- –°–æ–æ–±—â–µ–Ω–∏—è. –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è, –∞–¥—Ä–µ—Å–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ–±–µ –∏–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ id (–≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∞–¥—Ä–µ—Å–∞—Ç–∞). –°–æ–æ–±—â–µ–Ω–∏—è —à–∏—Ñ—Ä—É—é—Ç—Å—è —Å–∞–º–æ–¥–µ–ª—å–Ω–æ–π –∫—Ä–∏–ø—Ç–æ—Å–∏—Å—Ç–µ–º–æ–π. –°–µ—Ä–≤–∏—Å –Ω–µ —É–º–µ–µ—Ç —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞—Ç—å (–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ –¥–∞–∂–µ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ).
- –ö—Ä–∏–ø—Ç–æ—Å–∏—Å—Ç–µ–º–∞. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è [–∫—Ä–∏–ø—Ç–æ—Å–∏—Å—Ç–µ–º—ã –ü—ç–π–µ](https://en.wikipedia.org/wiki/Paillier_cryptosystem) —á–µ—Ä–µ–∑ gmp, –Ω–∞ –ø–µ—Ä–≤—ã–π –≤–∑–≥–ª—è–¥ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è. –Ø –Ω–µ –±—É–¥—É –∑–¥–µ—Å—å —Ä–∞—Å–ø–∏—Å—ã–≤–∞—Ç—å, –∫–∞–∫ –æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ—á–∏—Ç–∞–µ—Ç–µ —Å–∞–º–∏.

### –ü—Ä–æ—Å—Ç–∞—è —á–∞—Å—Ç—å
–û—á–µ–≤–∏–¥–Ω–∞—è –∏ —Å–∫—É—á–Ω–∞—è –æ—à–∏–±–∫–∞ –ª–µ–∂–∏—Ç –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `random_integer`:
```C
uint8_t seed = device();
```
–≠—Ç–æ—Ç —Å–∏–¥ - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ, –Ω–∞ —á–µ–º –±–∞–∑–∏—Ä—É–µ—Ç—Å—è PRNG, –ø–æ—ç—Ç–æ–º—É –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ–±–µ –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —á–∞—Å—Ç–∏ –∫–ª—é—á–∞ –∏ –ø–µ—Ä–µ–±—Ä–∞—Ç—å –ø–æ –Ω–∏–º. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ –∏ –≥–æ—Ç–æ–≤–æ. –ü–æ—á—Ç–∏ –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã —ç—Ç–æ –æ—Å–∏–ª–∏–ª–∏, –ø–æ—ç—Ç–æ–º—É –≤–¥–∞–≤–∞—Ç—å—Å—è –≤ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —è –Ω–µ –±—É–¥—É.

–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —è –±—ã–ª –æ—Ç–≤–ª–µ—á–µ–Ω –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏ –∏ –¥–æ–ª–≥–æ –Ω–µ –º–æ–≥ –∑–∞–º–µ—Ç–∏—Ç—å —ç—Ç—É, —á—Ç–æ –¥–æ–≤–æ–ª—å–Ω–æ —Å–∏–ª—å–Ω–æ —É—Ç—è–Ω—É–ª–æ –∫–æ–º–∞–Ω–¥—É –≤–Ω–∏–∑. 

### –°–ª–æ–∂–Ω–∞—è —á–∞—Å—Ç—å
–í–æ—Ç —ç—Ç–æ —É–∂–µ –ø–æ–≤–µ—Å–µ–ª–µ–µ; –ø–æ—á—Ç–∏ –Ω–∏–∫—Ç–æ –Ω–µ –¥–æ–∫–æ–ø–∞–ª—Å—è –¥–æ –≤—Ç–æ—Ä–æ–π —É—è–∑–≤–∏–º–æ—Å—Ç–∏. –í –∫–æ–¥–µ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ —Ä—è–¥ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫, –∫–∞–∑–∞–ª–æ—Å—å –±—ã, –Ω–µ –≤–ª–∏—è—é—â–∏—Ö –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- `mpz_class r = random_integer(32);` - `r` –Ω–µ —Ç–∞–∫–æ–µ –∂–µ –ø–æ —Ä–∞–∑–º–µ—Ä—É, –∫–∞–∫ `n`, –∞ –≤ –¥–≤–∞ —Ä–∞–∑–∞ –∫–æ—Ä–æ—á–µ. –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —è –Ω–µ –ø—Ä–∏–¥—É–º–∞–ª, –∫–∞–∫ —ç—Ç–æ —ç–∫—Å–ø–ª—É–∞—Ç–∏—Ä–æ–≤–∞—Ç—å.
- –û—à–∏–±–∫–∏ —É—Ç–µ–∫–∞—é—Ç –≤ –æ—Ç–≤–µ—Ç—ã —é–∑–µ—Ä—É, –º–æ–≥–ª–æ –±—ã –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã–º, –Ω–æ –Ω–µ –∑–¥–µ—Å—å.
- –°–æ–æ–±—â–µ–Ω–∏–µ _–º–∞–ª–µ–Ω—å–∫–æ–µ_, –≤—Å–µ–≥–æ 128 –±–∏—Ç. –û—á–µ–Ω—å –º–∞–ª–æ –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.
- `return res1 * res2;` - –•–º–º, –Ω–µ—Ç—É `% n2`. 6000 –±–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–µ–º—ã—Ö 4096 ü§î

–ó–∞ –≤—Ä–µ–º—è —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è —è –ø–µ—Ä–µ–ø—Ä–æ–±–æ–≤–∞–ª –∫—É—á—É –≤—Å–µ–≥–æ: —Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å —à—Ç—É–∫–∏, –¥–µ–ª–∏—Ç—å —à—Ç—É–∫–∏, –≥—É–≥–ª–∏—Ç—å —à—Ç—É–∫–∏, —Ä–∞—Å–ø–∏—Ö–∏–≤–∞—Ç—å —à—Ç—É–∫–∏ –≤ —Ç—É–ª–∑—ã. –ö–∞–∫ –æ–∫–∞–∑–∞–ª–æ—Å—å, —è —Ö–æ–¥–∏–ª –∫—Ä—É–≥–∞–º–∏, –∑–∞–º–µ—Ç–∏–≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∫–ª—é—á–µ–≤—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—Å—Ç–æ –Ω–µ —Å–∫–ª–∞–¥—ã–≤–∞–ª–∏—Å—å —É –º–µ–Ω—è –≤ –≥–æ–ª–æ–≤–µ –≤ —Ä–µ—à–µ–Ω–∏–µ.

–ß–µ—Ä–µ–∑ –ø–∞—Ä—É —á–∞—Å–æ–≤ —è —É–∂–µ –Ω–∞—á–∞–ª —Å–æ–º–Ω–µ–≤–∞—Ç—å—Å—è –≤ —Å—É—â–µ—Å—Ç–≤–∞–Ω–∏–∏ –¥—Ä—É–≥–æ–π —É—è–∑–≤–∏–º–æ—Å—Ç–∏, –Ω–æ –ø–æ —Å—É—Ç–∏ –æ—á–µ–≤–∏–¥–Ω—ã–µ –æ—à–∏–±–∫–∏ –Ω–µ –¥–∞–≤–∞–ª–∏ –º–Ω–µ –ø–æ–∫–æ—è...

–®–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ª—á–∞—Å–∞ —ç–≤–µ–Ω—Ç–∞. –Ø –ø–æ—à–µ–ª —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ—Ä—ã–≤, –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–µ–ª... –∏ –ø—Ä–æ—Å—Ç–æ –≤–æ—Ç –ø–æ–Ω—è–ª. –ù–µ –≤–µ—Ä–∏–ª –¥–æ —Å–∞–º–æ–≥–æ –∫–æ–Ω—Ü–∞, —á—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å.

–ü–æ –∏—Ç–æ–≥—É, –≤–æ—Ç –ø—Ä—è–º–æ–π –ø—É—Ç—å –∫ —Ä–µ—à–µ–Ω–∏—é, –º–∏–Ω—É—è –≤—Å–µ —Ç—É–ø–∏–∫–∏, –≤ –∫–æ—Ç–æ—Ä—ã—Ö —è –ø—Ä–æ—Ç–æ—Ä—á–∞–ª:
- –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: $\text{mod}((1 + n)^m, n^2) \cdot \text{mod}(r^n, n^2)$.
- –í —Å–æ–æ—Ç–≤–µ—Å—Ç–≤–∏–∏ —Å –æ—Å–Ω–æ–≤–Ω–æ–π –∏–¥–µ–µ–π –∫—Ä–∏–ø—Ç–æ—Å–∏—Å—Ç–µ–º—ã, –µ–≥–æ –º–æ–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –≤–æ—Ç —Ç–∞–∫: $\text{mod}(1 + nm, n^2) \cdot \text{mod}(r^n, n^2)$.
- –ó–∞–º–µ—Ç–∏–º, —á—Ç–æ $1 + nm < n^2$, –ø–æ—ç—Ç–æ–º—É –º–æ–∂–Ω–æ –¥–∞–ª—å—à–µ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –¥–æ $(1 + nm) \cdot \text{mod}(r^n, n^2)$.
- –¢–µ–ø–µ—Ä—å –∑–∞–º–µ–Ω–∏–º —à—Ç—É–∫—É —Å–ø—Ä–∞–≤–∞ –Ω–∞ –Ω–µ–∫–æ–µ $R$; –ø–æ–ª—É—á–∞–µ–º $(1 + nm) \cdot R$.
- –ú–Ω–æ–≥–æ—á–ª–µ–Ω $R+nmR-ct$ —Ç–æ–≥–¥–∞ –∏–º–µ–µ—Ç –∫–æ—Ä–µ–Ω—å $(m_0, R_0)$ —Å $m_0$ ~ 128 –±–∏—Ç –∏ $R_0$ ~ 4096 –±–∏—Ç. –°–º–æ—Ç—Ä—è –≤ [—Å–≤—è—â–µ–Ω–Ω—ã–µ –ø–∏—Å–∞–Ω–∏—è](http://www.crypto-uni.lu/jscoron/publications/bivariate.pdf) –ø—Ä–æ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –ö–æ–ø–ø–µ—Ä—Å–º–∏—Ç–∞, –º–æ–∂–Ω–æ –∑–∞–º–µ—Ç–∏—Ç—å, —á—Ç–æ $W$ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –¥–ª—è —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ —á–ª–µ–Ω–∞ $ct$ —Å 6370 –±–∏—Ç, –∫–æ–≥–¥–∞ $XY$ ~ 4224 –±–∏—Ç - –Ω–∞–º–Ω–æ–≥–æ –º–µ–Ω—å—à–µ, —á–µ–º $W$. –†–∞–∑ –Ω–∞–∏–±–æ–ª—å—à–∞—è —Å—Ç–µ–ø–µ–Ω—å –≤—Å–µ–≥–æ 1, –º–µ—Ç–æ–¥ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç.

–≠—Ç–æ—Ç –ø—É—Ç—å —è —Å–æ–∫—Ä–∞—Ç–∏–ª —É–∂–µ –ø–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è –≤ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç—è—Ö, –ø–æ—á–µ–º—É –∏ –∫–æ–≥–¥–∞ —ç—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ—Å–ª–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è). –í–æ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —à–∞–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ —è –¥–µ–ª–∞–ª –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ 
- –ó–∞–º–µ—Ç–∏–º, —á—Ç–æ $\text{mod}((1 + nm) \cdot R, n) = \text{mod}(R, n)$, –Ω–∞–∑–æ–≤–µ–º —ç—Ç–æ $e$. –¢–æ–≥–¥–∞ $R = kn + e$ –¥–ª—è –Ω–µ–∫–æ–µ–≥–æ $k$.
- –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: $(1 + nm)(kn + e)=kmn^2 + kn + emn + e$. –£ –º–Ω–æ–≥–æ—á–ª–µ–Ω–∞ –≤—Å–µ –µ—â–µ –ø–µ—Ä–≤–∞—è —Å—Ç–µ–ø–µ–Ω—å –∏ $W$ ~ 6370 bits, –Ω–æ –≥—Ä–∞–Ω–∏—Ü—ã –∫–æ—Ä–Ω–µ–π —É–ø–∞–ª–∏ –∞–∂ –¥–æ 2176 bits. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–æ–ª–≤–µ—Ä –Ω–∞–º–Ω–æ–≥–æ –±—ã—Å—Ç—Ä–µ–µ, –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–º.

### –û—Å—Ç–∞–ª—å–Ω–æ–µ
–≠–∫—Å–ø–ª–æ–∏—Ç (–Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –≤ —Ç–æ—Ä–æ–ø—è—Ö) —É—Å—Ç—Ä–æ–µ–Ω —Ç–æ–∂–µ –¥–æ–≤–æ–ª—å–Ω–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ:
- –í–æ-–ø–µ—Ä–≤—ã—Ö, —Ç—Ä–µ–±—É–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ gRPC, –ø–æ–¥—Ä–æ–±–Ω–µ–µ –≤ [–¥–æ–∫–∞—Ö](https://grpc.io/docs/languages/python/quickstart/).
- –í–æ-–≤—Ç–æ—Ä—ã—Ö, —Ç—Ä–µ–±—É–µ—Ç —Å–µ–π–¥–∂, –∏ —ç—Ç–æ –¥–∞–∂–µ –Ω–µ –≤—Å–µ. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–Ω —Ç–æ–ª—å–∫–æ (–∫–æ—Å—Ç—ã–ª—å–Ω–æ) –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è [crypto-attacks](https://github.com/jvdsn/crypto-attacks) —Ç.–∫. —è –≤—Å–µ –µ—â–µ –ø–æ–Ω—è—Ç–∏—è –Ω–µ –∏–º–µ—é, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ—Ç–æ–¥ –∏ –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥—Ä—É–≥–∏—Ö (—É–º–Ω—ã—Ö) –ª—é–¥–µ–π.
- –í–æ—Ç —Ç–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç —ç–∫—Å–ø–ª–æ–∏—Ç, –∫–æ–µ-–∫–∞–∫ —Å–æ–±—Ä–∞–Ω–Ω—ã–π –Ω–∞ –ø–æ–ª–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏:
```Python
#!/usr/bin/env python3

from sage.all import *
from primefac import primefac

path = os.path.dirname(os.path.dirname(os.path.dirname(os.path.realpath(os.path.abspath(__file__)))))
if sys.path[1] != path:
    sys.path.insert(1, path)

from shared.small_roots import coron

from crypter_pb2 import *
from crypter_pb2_grpc import *
from requests import get
from random import shuffle
import sys


sys.set_int_max_str_digits(999999)

ip = sys.argv[1]


data = get("https://cbsctf.live/api/client/attack_data/").json()
ids = [s.removeprefix("{\"message\": \"").removesuffix("\"}") for s  in data["crypter"][ip]]

with grpc.insecure_channel(f'{ip}:2112') as channel:
    stub = CrypterStub(channel)
    for msg_id in ids:
        message = stub.GetMessage(GetMessageRequest(id=str(msg_id)))
        public_key = stub.GetUserPublicKey(GetUserPublicKeyRequest(username=message.username))
        n = int(public_key.n)
        ct = int(message.encrypted)
        e = ct % n

        PR = PolynomialRing(ZZ, "m, k")
        m, k = PR.gens()

        poly = m * k * n ** 2 + m * e * n + k * n + e - ct

        sol = coron.integer_bivariate(poly, 1, 2 ** 128, 2 ** 2048)

        for sol in sol:
            m, k = sol
            print(int(m).to_bytes((int(m).bit_length() + 7) // 8, 'big'), flush=True)
```

–ö–æ–≥–¥–∞ —è –µ–≥–æ –≤—ã–∫–∞—Ç–∏–ª, —É –Ω–∞—Å –±—É–∫–≤–∞–ª—å–Ω–æ –∑–∞ —Ä–∞—É–Ω–¥ –ø—Ä–∏–±–∞–≤–∏–ª–æ—Å—å –æ–∫–æ–ª–æ 5000 –æ—á–∫–æ–≤, —á—Ç–æ –ø–µ—Ä–µ—Å—Ç–∞–≤–∏–ª–æ –Ω–∞—Å —Å –¥–µ—Å—è—Ç–æ–≥–æ —Å—Ä–∞–∑—É –Ω–∞ —à–µ—Å—Ç–æ–µ –º–µ—Å—Ç–æ. –ù–µ —Ç–æ —á—Ç–æ–±—ã —ç—Ç–æ –ø–æ–≤–ª–∏—è–ª–æ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –Ω–æ –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—Ä–∏—è—Ç–Ω–æ.
